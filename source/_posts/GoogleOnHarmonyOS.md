---
title: 在 HarmonyOS 上装 Google (资料汇总)
date: 2024-01-28 14:09:45
tags: 技术
---

这两天拿到了一部 HarmonyOS 4 的华为手机. 由于华为被禁止搭载 Google 服务, 所以安装 Google 的过程不算顺利, 装上去之后还提示 "Google Play Protect 未认证". 由于我的手机作为 Google 2FA 设备, 所以这个未认证的问题必须得到处理. 以下记录了安装 Google Play 系列服务的过程和参考资料.

<!-- more -->

首先要说明的是, **GSpace** 这种方法我不能接受. (没有为什么)

### 为了 GMS, 你需要越过长城, 走向世界

我采用的方法是直接在电脑上开局域网代理, 然后手机设置 **WLAN Proxy**. 原因: 这样最省事.

### 登录 Google 账号, 安装 GSF, Google Play Store

网上有一个叫 [华谷套件](https://bishua666.com/huagu2/#/) 的工具, 利用 ta 可以半自动地登录账号并到达疯狂弹出 Play Protect 认证失败界面的程度.

为了防止这玩意没了, 在此贴几个链接和表格:

1. 清除谷歌应用数据 (理论上, 没有)
2. 修改系统时间到 2020 年 7 月 10 日 (这个时候 Google 还没有禁止华为登录)
3. 打开备份, 从内部存储恢复 (套件里面提供了一个谷歌服务助手的备份镜像用于还原, 以绕过不允许安装的问题)
4. 激活谷歌服务助手 (只需要激活, 反正装不上去)
5. 还原系统时间
6. 安装 MicroG, 登录账号 (这时候账号出现了)
7. 安装多个谷歌应用 (可能是用于绕过新安装检测?), 这里安装了 GSF (和 Store 好像)
8. 卸载 MicroG
9. 安装 Google Play Service

### 解决未认证问题

主要参考 [知乎的文章](https://zhuanlan.zhihu.com/p/421243092), 如果寄了参考 [本地拷贝](GoogleOnHarmonyOS/zhihu_download.html)

感觉大部分的方法都是暂时性的. 里面提到两种解决方案, 一种是通过重置手机的 GMS 服务, 让它 *认为* 你是可用的设备; 另一种是去 [官网](https://www.google.com/android/uncertified/) 单独注册你这一个手机, 作为 "自定义 ROM 用户".

反正现在暂时没出事, 后续如果出事再说. 里面提到可以通过禁用 GMS 联网来防止自动更新, 但是由于 2FA 需要联网, 所以无法实现. 理论上可以通过特殊的设置实现, 但是可能需要 Root 权限.

*(一天后)*: 于是乎不到一天就出事了, 还是经典的未认证问题. 我把 GSF ID 单独认证了也没啥用. 目前的状况是把 GSF 的通知权限关了, 免得弹通知; 然后把 GSF 的联网权限关了, 免得自动更新和莫名其妙再未认证. Google Play 在手机重启并清除数据之后能打开更新软件, 但开着放个大半天就未认证了. 由于为题发生的频率过高, 我懒得折腾了.

Poe 等依赖于 Google Play 的软件依然无法使用 (怎么和没装 GMS 一样). 但至少还能更新软件 (虽然有点麻烦).

### 禁用更新

为了防止夜长梦多 (比如 HarmonyOS Next), 我用 adb 把更新和一些玩意给禁用了. 考虑参考 [B 站的专栏](https://www.bilibili.com/read/cv21078097/), 或者直接搜索包名, 或者下一个 ES File Explorer 看一下.
