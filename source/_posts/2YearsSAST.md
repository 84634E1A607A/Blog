---
updated: 2025-05-08 15:04:57
title: 在科协的两年
date: 2025-05-08 10:54:21
tags:
  - 流水账
---

随着新一届的学代会即将在 5 月底召开, 我在科协的 ~~任期~~ ~~折腾~~ ~~被折腾~~ 的日子也差不多到头了 (大雾). 这两年里我到底干了什么事情, 究竟有什么成就 (感觉没啥) 呢? 不妨在此梳理一下.



<!-- more -->



## 开端

加入科协的时候我才刚从电机系转系过来. 那个时候的我还没有被老贵狠狠调教 (大雾), 觉得浑身充满了力量 (大雾), 听说科协都是大佬 (被忽悠惨了), 于是选择了加入看看. 当时我在计算机系认识的人不多 (现在也不多), 主要是 [孙迅](https://www.unidy.cn/), 而他是之前的科协智能体部的副部长. 于是我就糊里糊涂地加入了.

我还记得的第一件事是网络部的面试, 当时我简述了自己的经历和经验, 疑似吓到了部分学长 (笑), 于是毫无悬念就通过了.

第二件事是网络部的第一次 (唯一一次, 乐) 部会, 大家在南区地下吃麦当劳, ayf 激动地阐述了他宏伟的要把 308 改造成网咖的计划 Approval9 (结果是 308 成了寝室, 乐) 和宏伟的要找教学实验室拿到 10 台服务器搞 K8s 集群给同学们提供数据库服务的计划 Database9 (结果服务器跳票了, 乐). 我真是被忽悠瘸了 ()

这时候我听说科协有一些服务器可以玩, 于是我就迈步走向了运维的大坑.

科协网络部有个 Telegram 群, 得益于 Telegram 可以云端保存聊天记录, 我得以查找这两年来发生的事情, 以免依赖于我并不准确的记忆.



## 学生节的网

上溯到 2023 年 9 月 30 号, 我试图把已经无人知道怎么回事的学生节的网扬了重造, 卡在了不知道密码. [Papersnake](https://pka.moe/) 把咱拉进了 Telegram 群. 不过我的聊天记录并非从此开始. 在此之前, Abmfy 在 2023 年 6 月 4 日进群; 2023 年 7 月 26 日, Rug 上有盘 SMART 告警; 2023 年 8 月 5 号, stu.cs. 由于 Hera 的存储池满了而崩溃; 2023 年 8 月 16 日, 科协的校园网账号被封号...

然后 9 月 30 号, 我一天干出了这个群前半年的消息数. 我试图研究了当年宇翔学长留下来的硬件弹幕机 (没有看懂). 然后我当时试图给我们的 WLC 升级固件, 结果我们 WLC 停止支持了官网没法下载固件, 于是去群里捞捞, 得到回复是:

> 不重要

> 系里交换机固件还是2011年的

不过后来我通过神奇的渠道找到了最新的固件, 遂打算升级. 结果学长表示:

> 哈哈，harry上次升级cisco交换机，然后就boot fail了
>
> 解决办法是把flash吹下来，从另一台好的重新烧进去

> 从此我都不敢动 cisco
>
> 成功治好了我的升级强迫症

> 原因是引导新的 image->新的 image 发现 bootrom 旧->刷写 bootrom->刷到一半，另一个 systemd 启动的 service 挂了->那个 service 配置了 fail = reboot ->于是重启了

不过我还是有升级强迫症, 后来还是升级了. 升级解决了一些奇怪的 WebUI 的问题, 还算有点用.

我当时还完全不会配 Linux 的网, 趁着十一假期狠狠学习并轰炸学长. 一开始我配了个 OpenWRT, 被学长蛐蛐说是 "家用级设备" (我现在也这么觉得了); 于是迎着头皮开始重新配 Debian 软路由 (当时我还在担心 Hyper-V 虚拟机能不能跑满千兆). 我在群里表示我配不明白 iptables 啥的, Harry 表示:

> 我的建议是不要依赖工具，你还是得知道它们怎么工作，要怎么配

也对. 于是在 ~3k 条消息之后, 我成功搓出了第一版全是 Bug 但是 it just works 的 {% post_link StudentFestivalNetwork "新方案" %}.

在这个过程中我一直在群里问一些我现在看十分愚蠢的问题 (x) 学长也觉得十分愚蠢 (x) 但是至少我问了, 我在学, 所以学长们还是很愿意教的.



## 接入 Tinc

这之后我试图给学生节的路由接入管理网, 去问学长们怎么整, 学长表示科协有一个 Tinc 内网. 当时各个服务器的 Tinc 还是用的原始脚本. 我给我自己也开了一个 Tinc 的内网节点, 方便折腾. 在这样的情况下, 可以说已经拿到了核心权限 (吗?).



## 更新 Gitlab

那时候我们讨论的过程中提到了科协的 [Gitlab](https://git.net9.org) (现在因为实在没人用已经给关了), 那时已经落后主线相当多的版本了. 当时清华 Git 也是.

于是后来我就尝试升级了我们的 Gitlab. 这时我已经拿到了 60% 的科协服务的权限, 在 Hera 上新建了一个虚拟机, 折腾了几天, 成功按照 Upgrade Path 升级到了当时的最新版. 详见 {% post_link UpgradingGitlab 这篇博客 %}. 当时正巧学长们也决定对清华 Git 动土, 也算是探了个路.



## 在 308 淘宝

那时候我还在 308 淘宝, 翻箱倒柜, 想看看能不能找到什么神奇的东西. 我还真找到了. 308 有 82.3GB 容量的机械硬盘, 有一万个各种奇怪的大小和电压的充电器, 榨汁机 (科协活动室为什么有榨汁机?), 有 IDE 和 SCSI 接口的硬盘 (比我年龄大, 可惜没有照片), 谭浩强文选, 酒井文集 (现在得改叫九井文集了), 比显卡大的 CPU (对, Pentium Xeon II)...... 也是开眼了!



## 折腾旧服务器

然后我当时热衷于折腾旧服务器, 先是把一个古老的奔腾拿来当存储池, 研究 zfs; 然后又是把旧服务器到底干嘛用的刨了个遍. 对此 Harry 表示

> 你非要盯着旧服务器干啥。。。

> 真的别用旧的了，对 308 的电费好

但是我就要折腾, 还是找了 4 块 4T 的盘组 RAID5, 后来被神奇的 RAID 卡折腾了一阵之后决定改用 ZFS, 又被 Harry 拷打了一阵之后算是弄好了 (当时的 4 块盘甚至有两块是 SMR)



## 归档旧虚拟机

这之后由于 Hera 之前的存储池要满了, 我在 Server4 建好之后把 Hera 上面的 FTP9 等几个虚拟机搬回了 Server4. 对此, 把 FTP9 从 Server4 搬到 Hera 上的学长表示,

> 兜兜转转又回来了

然后现有的虚拟机都挨个问了一遍, 该关的关了, 该 Archive 的导出到 Server4 之后删了.

这时有个我很绷不住 (Harry 也很绷不住) 的事情, 我们之前有一个 IPTV 的服务叫 TV9, 它的虚拟机硬盘名称叫 "新建虚拟磁盘.vmdk". 由于这个名字起的实在太好还放在根目录里面, 我在浏览磁盘中的数据的时候毫不犹豫就点了 Delete. 由于一切正常, 虚拟机没开, 删除操作十分成功. 对此 Harry 表示

> 不是，不正式怎么了，这点空间能值几个钱，hera 上面还有几块硬盘压根没用上呢，没搞明白之前别乱删啊

我的评价是, 他都叫 "新建虚拟机" 和 "新建虚拟磁盘" 了...

然后因为这个我们决定把 Hera 上面的两块没用上的盘挂上去. 我在组建了 RAID1 之后尝试扩容现有的 Datastore, 于是有了 Harry 经典表情包

<div style="display: flex; flex-direction: row; justify-content: space-evenly;">

![NO](2YearsSAST/NO.png)

![STOP](2YearsSAST/STOP.png)

</div>



## 迁移 Rug 上的服务

如前面所述, Rug 上的 SMART 报警已经挺久了. 趁 Server4 新阵列和 Hera 归档这个机会, 我把 Rug 上的服务 (Git9) 和数据 (备份数据) 分别转移到了 Hera 和 Server4. Rug 的盘就不管了.



## 修 Card9

还记得之前说的 Approval9 吗? 308 本来是有个门锁的, 但是它当时出现了一些物理损坏 (长期拉扯导致电源线的焊点脱落了). 我把它重新焊了上去, 后来干脆量了量尺寸 3D 打印了个壳.



## 锁定不登录的用户

后来我们发现有人用科协的账号登录自己的设备, 问了问是谁也没人知道, 遂决定更改密码 + 锁定不常用用户.



## 升级服务器

然后我把 Zeus 从 Buster 升级到了 Bookworm, 把 Rug 从 14.04 升级到了 22.04, 中间炸了两次 usrmerge.



## 大改 Hera 的 iptables

由于之前大量的虚拟机变更, Hera 的 iptables 里面出现了大量的过时内容. 我因此大改了 iptables, 手动整理了每一行在干嘛. 没什么大事发生, 就不多写了.



## 修 308 的闭门器





